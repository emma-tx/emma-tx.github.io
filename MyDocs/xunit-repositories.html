
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-8.0.5">
    
    
  <title>Michael's Site</title>

    
      <link rel="stylesheet" href="../assets/stylesheets/main.a617204b.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.9204c3b2.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#net-core-creating-an-xunit-test-for-an-application-with-a-generic-repository-pattern" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../index.html" title="Scarbrough@GitHub" class="md-header__button md-logo" aria-label="Scarbrough@GitHub" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Scarbrough@GitHub
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Unit Testing with xUnit and Repositories
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../index.html" class="md-tabs__link">
      Home
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../projects.html" class="md-tabs__link">
      Projects
    </a>
  </li>

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="index.html" class="md-tabs__link md-tabs__link--active">
        My Docs
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../index.html" title="Scarbrough@GitHub" class="md-nav__button md-logo" aria-label="Scarbrough@GitHub" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Scarbrough@GitHub
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../index.html" class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../projects.html" class="md-nav__link">
        Projects
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" checked>
      
      
      
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="index.html">My Docs</a>
          
            <label for="__nav_3">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="My Docs" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          My Docs
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="suggested-toolset.html" class="md-nav__link">
        Suggested Toolset
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="development-standards.html" class="md-nav__link">
        Development Standards
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="software-architecture-doc.html" class="md-nav__link">
        Software Architecture Document
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="github.html" class="md-nav__link">
        GitHub
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="docker.html" class="md-nav__link">
        Docker
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="solid.html" class="md-nav__link">
        SOLID Development
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="jso n-web-tokens.md" class="md-nav__link">
        JSON Web Tokens
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="linux-kernel-module.html" class="md-nav__link">
        Linux Kernel Modules
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="opencart.html" class="md-nav__link">
        OpenCart Development Notes
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_11" type="checkbox" id="__nav_3_11" checked>
      
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3_11">
          DotNet
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="DotNet" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_11">
          <span class="md-nav__icon md-icon"></span>
          DotNet
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="dotnet-core-6-ajax.html" class="md-nav__link">
        AJAX Requests in DotNET Core 6 MVC
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="ajax-view-injection.html" class="md-nav__link">
        AJAX View Injection
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="web-services.html" class="md-nav__link">
        Web Services
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Unit Testing with xUnit and Repositories
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="xunit-repositories.html" class="md-nav__link md-nav__link--active">
        Unit Testing with xUnit and Repositories
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#setting-up-a-unit-test-project" class="md-nav__link">
    Setting Up a Unit Test Project
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-a-home-controller-method" class="md-nav__link">
    Testing a Home Controller Method
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#attaching-repositories-using-setup" class="md-nav__link">
    Attaching Repositories Using Setup()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adding-mock-entities" class="md-nav__link">
    Adding Mock Entities
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-the-return-data" class="md-nav__link">
    Testing the Return Data
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="web-apis.html" class="md-nav__link">
        Web APIs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="code-first-setup.html" class="md-nav__link">
        Code First Entity Framework
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="identity-users-extension.html" class="md-nav__link">
        Extending ASP.NET IdentityUsers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="dotnet-core-6-mvc.html" class="md-nav__link">
        DotNET Core 6 MVC and Entity Framework
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_12" type="checkbox" id="__nav_3_12" >
      
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3_12">
          Database
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Database" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_12">
          <span class="md-nav__icon md-icon"></span>
          Database
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="basic-sql.html" class="md-nav__link">
        Basic SQL Scripts
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="sqlite.html" class="md-nav__link">
        SQLite3
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="docker-sql-server.html" class="md-nav__link">
        Docker and SQL Server
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_13" type="checkbox" id="__nav_3_13" >
      
      
      
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3_13">
          Python
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Python" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_13">
          <span class="md-nav__icon md-icon"></span>
          Python
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="jupyter.html" class="md-nav__link">
        Jupyter Notebooks
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="pycrypto-aes.html" class="md-nav__link">
        PyCrypto AES
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="python-authentication.html" class="md-nav__link">
        Authentication with Python
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="smartcards.html" class="md-nav__link">
        Smart Card Programming
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#setting-up-a-unit-test-project" class="md-nav__link">
    Setting Up a Unit Test Project
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-a-home-controller-method" class="md-nav__link">
    Testing a Home Controller Method
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#attaching-repositories-using-setup" class="md-nav__link">
    Attaching Repositories Using Setup()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adding-mock-entities" class="md-nav__link">
    Adding Mock Entities
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-the-return-data" class="md-nav__link">
    Testing the Return Data
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                

<h1 id="net-core-creating-an-xunit-test-for-an-application-with-a-generic-repository-pattern">.NET Core: Creating an xUnit Test for an Application with a Generic Repository Pattern</h1>
<p>In all honesty I found it pretty damn hard to get this working, and I was questioning whether I should have used Unit of Work in the first place (there are already layers of abstraction in the standard .NET Core template project). I managed to get a functioning <a href="https://xunit.net">xUnit test</a> method that mocks the repositories, populates them with data and verifies the model returned by a controller method.</p>
<h2 id="setting-up-a-unit-test-project">Setting Up a Unit Test Project</h2>
<p>Add a xUnit project to the solution, then add an assembly reference in that to the project being tested. Just to check the test method executes and to show the format of a basic class:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a>using Xunit;
<a id="__codelineno-0-2" name="__codelineno-0-2"></a>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a>public class UnitTest1
<a id="__codelineno-0-4" name="__codelineno-0-4"></a>{
<a id="__codelineno-0-5" name="__codelineno-0-5"></a>  [Fact]
<a id="__codelineno-0-6" name="__codelineno-0-6"></a>  public void SimpleTest()
<a id="__codelineno-0-7" name="__codelineno-0-7"></a>  {
<a id="__codelineno-0-8" name="__codelineno-0-8"></a>    int five = 5;
<a id="__codelineno-0-9" name="__codelineno-0-9"></a>    Assert.Equal(5, five);
<a id="__codelineno-0-10" name="__codelineno-0-10"></a>  }
<a id="__codelineno-0-11" name="__codelineno-0-11"></a>}
</code></pre></div>
<p>When the test is run, the method will execute and show in the results as a test that passed. That's because I declared five as '5', and used <em>Assert.Equal</em> to check the two values match.</p>
<p>Test methods typically have sections for Arrange, Act and Assert - instantiating a data model, defining an expected result and comparing the actual result against it - and, of course, there are multiple Assert methods that could be used for testing various other conditions.
And, if your code is anything like mine (which deviated somewhat from the prescribed way of doing things), it will need to:
- Create a test instance of IUnitOfWork and pass that to the application's controller
- Create mock repositories
- Associate test entities with the repositories
- Check the test entities against what's returned by the controller being tested</p>
<h2 id="testing-a-home-controller-method">Testing a Home Controller Method</h2>
<p>Unit testing a <em>HomeController</em> in a .NET Core application that's using the repository pattern is less straightforward. I'm not using DbContext or the Entity Framework model directly. The good news is it's not necessary to duplicate the Repository Pattern or the Unit of Work, as they can be imported from the application project:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1"></a>using DotNetCore6.Controllers;
<a id="__codelineno-1-2" name="__codelineno-1-2"></a>using DotNetCore6.Data;
<a id="__codelineno-1-3" name="__codelineno-1-3"></a>using DotNetCore6.Models;
<a id="__codelineno-1-4" name="__codelineno-1-4"></a>using Microsoft.AspNetCore.Mvc;
<a id="__codelineno-1-5" name="__codelineno-1-5"></a>using System.Collections.Generic;
</code></pre></div>
<p>The unit test must create an instance of <em>HomeController</em>, which requires <em>something</em> like <em>IUnitOfWork</em> to be passed to it. This takes the place of DbContext.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a>public HomeController(IUnitOfWork unitOfWork)
<a id="__codelineno-2-2" name="__codelineno-2-2"></a>{
<a id="__codelineno-2-3" name="__codelineno-2-3"></a>  _unitOfWork = unitOfWork;
<a id="__codelineno-2-4" name="__codelineno-2-4"></a>}
</code></pre></div>
<p><a href="https://github.com/Moq/moq4/wiki/Quickstart">Moq</a> can be used for creating a test instance of <em>IUnitOfWork</em> and the repositories, and for passing them to <em>HomeController</em>. The method under test, <em>PowerOn()</em>, simply fetches a list of computers from the <em>Computers</em> model and returns that in a view.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1"></a>[Fact]
<a id="__codelineno-3-2" name="__codelineno-3-2"></a>public void TestPowerOnView()
<a id="__codelineno-3-3" name="__codelineno-3-3"></a>{
<a id="__codelineno-3-4" name="__codelineno-3-4"></a>    var mockUoW = new Mock&lt;IUnitOfWork&gt;();
<a id="__codelineno-3-5" name="__codelineno-3-5"></a>    var powerOnService = new HomeController(mockUoW.Object).PowerOn();
<a id="__codelineno-3-6" name="__codelineno-3-6"></a>    var result = powerOnService.View();
<a id="__codelineno-3-7" name="__codelineno-3-7"></a>    Assert.IsType&lt;ViewResult&gt;(result);
<a id="__codelineno-3-8" name="__codelineno-3-8"></a>}
</code></pre></div>
<p>After setting a breakpoint within the <em>HomeController</em> constructor and running the test in debug mode, it will be evident that something like <em>IUnitOfWork</em> had been passed to it, and there are references to the Entity Framework models.</p>
<h2 id="attaching-repositories-using-setup">Attaching Repositories Using Setup()</h2>
<p>The next step is to attach the repositories to the Unit of Work being passed to <em>HomeController</em>. The <em>Setup()</em> method will do all the work of adding them to <em>Mock<IUnitOfWork>()</em> anyway.</p>
<p>If we use something like the following code (the <em>GetAll()</em> method is defined in <em>my</em> implementation of Unit of Work) and set a breakpoint on the <em>HomeController</em> again, we find that it's discovered <em>IComputersRepository</em>, <em>ILabsRepository</em> and <em>IUsersRepository</em>. The interfaces don't refer to actual repositories or entities yet.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1"></a>[Fact]
<a id="__codelineno-4-2" name="__codelineno-4-2"></a>public void TestPowerOnView()
<a id="__codelineno-4-3" name="__codelineno-4-3"></a>{
<a id="__codelineno-4-4" name="__codelineno-4-4"></a>      var mockUoW = new Mock&lt;IUnitOfWork&gt;();
<a id="__codelineno-4-5" name="__codelineno-4-5"></a>
<a id="__codelineno-4-6" name="__codelineno-4-6"></a>      mockUoW.Setup(a =&gt; a.Computers.GetAll());
<a id="__codelineno-4-7" name="__codelineno-4-7"></a>      mockUoW.Setup(a =&gt; a.Labs.GetAll());
<a id="__codelineno-4-8" name="__codelineno-4-8"></a>      mockUoW.Setup(a =&gt; a.Users.GetAll());
<a id="__codelineno-4-9" name="__codelineno-4-9"></a>
<a id="__codelineno-4-10" name="__codelineno-4-10"></a>      var powerOnService = new HomeController(mockUoW.Object).PowerOn();
<a id="__codelineno-4-11" name="__codelineno-4-11"></a>
<a id="__codelineno-4-12" name="__codelineno-4-12"></a>      var result = powerOnService;
<a id="__codelineno-4-13" name="__codelineno-4-13"></a>      Assert.IsType&lt;ViewResult&gt;(result);
<a id="__codelineno-4-14" name="__codelineno-4-14"></a>}
</code></pre></div>
<h2 id="adding-mock-entities">Adding Mock Entities</h2>
<p>The next problem is that of getting the entities passed to the controller. Normally a repository will refer to an IEnumerable/List<Entities>. For the sake of making things easier to follow, I've created a mock repository within the test method.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1"></a>[Fact]
<a id="__codelineno-5-2" name="__codelineno-5-2"></a>public void TestPowerOnView()
<a id="__codelineno-5-3" name="__codelineno-5-3"></a>{
<a id="__codelineno-5-4" name="__codelineno-5-4"></a>  List&lt;Computers&gt; mockComputer = new List&lt;Computers&gt;()
<a id="__codelineno-5-5" name="__codelineno-5-5"></a>  {
<a id="__codelineno-5-6" name="__codelineno-5-6"></a>      new Computers()
<a id="__codelineno-5-7" name="__codelineno-5-7"></a>      {
<a id="__codelineno-5-8" name="__codelineno-5-8"></a>          id = 1,
<a id="__codelineno-5-9" name="__codelineno-5-9"></a>          host = &quot;TEST COMPUTER&quot;,
<a id="__codelineno-5-10" name="__codelineno-5-10"></a>          ip = &quot;193.134.9.5&quot;,
<a id="__codelineno-5-11" name="__codelineno-5-11"></a>          mac = &quot;TEST MAC ADDRESS&quot;,
<a id="__codelineno-5-12" name="__codelineno-5-12"></a>          subnet = &quot;255.255.0.0&quot;,
<a id="__codelineno-5-13" name="__codelineno-5-13"></a>          broadcast = &quot;255.255.255.255&quot;,
<a id="__codelineno-5-14" name="__codelineno-5-14"></a>          created_at = System.DateTime.Now,
<a id="__codelineno-5-15" name="__codelineno-5-15"></a>          updated_at = System.DateTime.Now
<a id="__codelineno-5-16" name="__codelineno-5-16"></a>      }
<a id="__codelineno-5-17" name="__codelineno-5-17"></a>    };
<a id="__codelineno-5-18" name="__codelineno-5-18"></a>
<a id="__codelineno-5-19" name="__codelineno-5-19"></a>    var mockUoW = new Mock&lt;IUnitOfWork&gt;();
<a id="__codelineno-5-20" name="__codelineno-5-20"></a>
<a id="__codelineno-5-21" name="__codelineno-5-21"></a>    mockUoW.Setup(a =&gt; a.Computers.GetAll()).Returns(mockComputer);
<a id="__codelineno-5-22" name="__codelineno-5-22"></a>
<a id="__codelineno-5-23" name="__codelineno-5-23"></a>    var powerOnService = new HomeController(mockUoW.Object).PowerOn();
<a id="__codelineno-5-24" name="__codelineno-5-24"></a>
<a id="__codelineno-5-25" name="__codelineno-5-25"></a>    var result = powerOnService;
<a id="__codelineno-5-26" name="__codelineno-5-26"></a>    Assert.IsType&lt;ViewResult&gt;(result);
<a id="__codelineno-5-27" name="__codelineno-5-27"></a>}
</code></pre></div>
<p>The method will try <em>GetAll()</em> with an empty repository, but still return the entities in <em>mockComputer</em>. What I didn't realise is we need to put a breakpoint in the method being tested itself to see the model being passed into it.</p>
<p>This test will pass, but it only verifies that a view was returned by PowerOn(). It doesn't tell us anything about the data being returned.</p>
<h2 id="testing-the-return-data">Testing the Return Data</h2>
<p>In this case, getting the model returned also wasn't straightforward, as I couldn't access the model directly. I needed to add some extra code to extract that.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1"></a>var viewResult = Assert.IsType&lt;ViewResult&gt;(result);
<a id="__codelineno-6-2" name="__codelineno-6-2"></a>var model = Assert.IsAssignableFrom&lt;IEnumerable&lt;Computers&gt;&gt;(viewResult.ViewData.Model);
<a id="__codelineno-6-3" name="__codelineno-6-3"></a>
<a id="__codelineno-6-4" name="__codelineno-6-4"></a>Assert.Equal(mockComputer, model);
</code></pre></div>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="web-services.html" class="md-footer__link md-footer__link--prev" aria-label="Previous: Web Services" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Web Services
            </div>
          </div>
        </a>
      
      
        
        <a href="web-apis.html" class="md-footer__link md-footer__link--next" aria-label="Next: Web APIs" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Web APIs
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tabs", "navigation.sections", "navigation.indexes"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../assets/javascripts/workers/search.cefbb252.min.js"}</script>
    
    
      <script src="../assets/javascripts/bundle.a5f8ea78.min.js"></script>
      
    
  </body>
</html>