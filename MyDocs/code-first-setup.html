
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-8.0.5">
    
    
  <title>Michael's Site</title>

    
      <link rel="stylesheet" href="../assets/stylesheets/main.a617204b.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.9204c3b2.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#setting-up-a-data-source-using-the-code-first-entity-framework-model" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../index.html" title="Scarbrough@GitHub" class="md-header__button md-logo" aria-label="Scarbrough@GitHub" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Scarbrough@GitHub
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Code First Entity Framework
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../index.html" class="md-tabs__link">
      Home
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../projects.html" class="md-tabs__link">
      Projects
    </a>
  </li>

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="index.html" class="md-tabs__link md-tabs__link--active">
        My Docs
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../index.html" title="Scarbrough@GitHub" class="md-nav__button md-logo" aria-label="Scarbrough@GitHub" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Scarbrough@GitHub
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../index.html" class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../projects.html" class="md-nav__link">
        Projects
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" checked>
      
      
      
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="index.html">My Docs</a>
          
            <label for="__nav_3">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="My Docs" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          My Docs
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="suggested-toolset.html" class="md-nav__link">
        Suggested Toolset
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="development-standards.html" class="md-nav__link">
        Development Standards
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="software-architecture-doc.html" class="md-nav__link">
        Software Architecture Document
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="github.html" class="md-nav__link">
        GitHub
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="docker.html" class="md-nav__link">
        Docker
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="solid.html" class="md-nav__link">
        SOLID Development
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="jso n-web-tokens.md" class="md-nav__link">
        JSON Web Tokens
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="linux-kernel-module.html" class="md-nav__link">
        Linux Kernel Modules
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="opencart.html" class="md-nav__link">
        OpenCart Development Notes
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_11" type="checkbox" id="__nav_3_11" checked>
      
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3_11">
          DotNet
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="DotNet" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_11">
          <span class="md-nav__icon md-icon"></span>
          DotNet
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="dotnet-core-6-ajax.html" class="md-nav__link">
        AJAX Requests in DotNET Core 6 MVC
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="ajax-view-injection.html" class="md-nav__link">
        AJAX View Injection
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="web-services.html" class="md-nav__link">
        Web Services
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="xunit-repositories.html" class="md-nav__link">
        Unit Testing with xUnit and Repositories
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="web-apis.html" class="md-nav__link">
        Web APIs
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Code First Entity Framework
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="code-first-setup.html" class="md-nav__link md-nav__link--active">
        Code First Entity Framework
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#generating-the-first-migration-script-and-database-from-identitymodel" class="md-nav__link">
    Generating the First Migration Script and Database From IdentityModel
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-our-own-model" class="md-nav__link">
    Creating Our Own Model
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adding-the-model-to-dbcontext" class="md-nav__link">
    Adding the Model to DbContext
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#generating-the-migration-script-and-applying-the-changes" class="md-nav__link">
    Generating the Migration Script and Applying the Changes
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#final-thing-populating-a-database-table-for-an-mvc-drop-down-menu" class="md-nav__link">
    Final Thing: Populating a Database Table for an MVC Drop-Down Menu
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="identity-users-extension.html" class="md-nav__link">
        Extending ASP.NET IdentityUsers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="dotnet-core-6-mvc.html" class="md-nav__link">
        DotNET Core 6 MVC and Entity Framework
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_12" type="checkbox" id="__nav_3_12" >
      
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3_12">
          Database
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Database" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_12">
          <span class="md-nav__icon md-icon"></span>
          Database
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="basic-sql.html" class="md-nav__link">
        Basic SQL Scripts
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="sqlite.html" class="md-nav__link">
        SQLite3
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="docker-sql-server.html" class="md-nav__link">
        Docker and SQL Server
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_13" type="checkbox" id="__nav_3_13" >
      
      
      
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3_13">
          Python
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Python" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_13">
          <span class="md-nav__icon md-icon"></span>
          Python
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="jupyter.html" class="md-nav__link">
        Jupyter Notebooks
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="pycrypto-aes.html" class="md-nav__link">
        PyCrypto AES
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="python-authentication.html" class="md-nav__link">
        Authentication with Python
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="smartcards.html" class="md-nav__link">
        Smart Card Programming
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#generating-the-first-migration-script-and-database-from-identitymodel" class="md-nav__link">
    Generating the First Migration Script and Database From IdentityModel
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-our-own-model" class="md-nav__link">
    Creating Our Own Model
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adding-the-model-to-dbcontext" class="md-nav__link">
    Adding the Model to DbContext
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#generating-the-migration-script-and-applying-the-changes" class="md-nav__link">
    Generating the Migration Script and Applying the Changes
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#final-thing-populating-a-database-table-for-an-mvc-drop-down-menu" class="md-nav__link">
    Final Thing: Populating a Database Table for an MVC Drop-Down Menu
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                

<h1 id="setting-up-a-data-source-using-the-code-first-entity-framework-model">Setting Up a Data Source Using the Code-First Entity Framework Model</h1>
<p>Since most my .NET projects for the past several years have been for clinical systems, I’ve been working from Database-First Entity Framework models. The software needed to be designed around whatever database schemas and stored procedures already existed, and data models needed to be generated from them. So, it’s only quite recently that I’ve looked at Code-First models, which seem more appropriate to situations in which we’d want a database schema to evolve as an application is being developed.</p>
<p>With the Code-First method, the data model is defined in the application’s code, and we sync the changes to the database.<br />
To try the following example, you’ll need to create a new ASP.NET MVC project in Visual Studio, and ensure it’s created with the ‘<em>Individual User Accounts</em> option (click the ‘<em>Change Authentication</em>‘ button when choosing the template), as I’m using classes within a file called ‘<em>IdentityModels.cs</em>‘ to set up the initial model and schema. When the project is loaded, right-click on the project and select ‘<em>Manage NuGet Packages…</em>‘. If Entity Framework isn’t already installed, install it.</p>
<p>We should be set up for the first step. It might be worth hanging onto the project if you’re following this example, because a future post will be going into developing the controllers to read and write data using this.</p>
<h2 id="generating-the-first-migration-script-and-database-from-identitymodel">Generating the First Migration Script and Database From IdentityModel</h2>
<p>First let’s take a look at the <em>IdentityModels.cs</em> file, as the two classes in here are important for understanding the Code-First method. The first class is <em>ApplicationUser</em>. I’m still not entirely sure how it works, as the implementations are hidden, but it uses <em>IdentityUser</em> as its base class, and I want to later extend an instance of this with a property that defines the application user name.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a>public class ApplicationUser : IdentityUser
<a id="__codelineno-0-2" name="__codelineno-0-2"></a>{
<a id="__codelineno-0-3" name="__codelineno-0-3"></a>    public async Task&lt;ClaimsIdentity&gt; GenerateUserIdentityAsync(UserManager&lt;ApplicationUser&gt; manager)
<a id="__codelineno-0-4" name="__codelineno-0-4"></a>    {
<a id="__codelineno-0-5" name="__codelineno-0-5"></a>        var UserIdentity = await manager.CreateIdentityAsync(this, DefaultAuthenticationTypes.ApplicationCookie);
<a id="__codelineno-0-6" name="__codelineno-0-6"></a>        return userIdentity;
<a id="__codelineno-0-7" name="__codelineno-0-7"></a>    }
<a id="__codelineno-0-8" name="__codelineno-0-8"></a>}
</code></pre></div>
<p>The second is the <em>DbContext</em>. Currently it references a connection string in <em>Web.config</em> named ‘<em>DefaultConnection</em>.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1"></a>public class ApplicationDbContext : IdentityDbContext&lt;ApplicationUser&gt;
<a id="__codelineno-1-2" name="__codelineno-1-2"></a>{
<a id="__codelineno-1-3" name="__codelineno-1-3"></a>    public ApplicationDbContext()
<a id="__codelineno-1-4" name="__codelineno-1-4"></a>    :base(&quot;DefaultConnection&quot;, throwIfV1Schema:false)
<a id="__codelineno-1-5" name="__codelineno-1-5"></a>    {
<a id="__codelineno-1-6" name="__codelineno-1-6"></a>    }
<a id="__codelineno-1-7" name="__codelineno-1-7"></a>
<a id="__codelineno-1-8" name="__codelineno-1-8"></a>    public static ApplicationDbContext Create()
<a id="__codelineno-1-9" name="__codelineno-1-9"></a>    {
<a id="__codelineno-1-10" name="__codelineno-1-10"></a>        return new ApplicationDbContext();
<a id="__codelineno-1-11" name="__codelineno-1-11"></a>    }
<a id="__codelineno-1-12" name="__codelineno-1-12"></a>}
</code></pre></div>
<p>In my project, these classes are within the namespace ‘<em>CodeFirstExample.Models</em>‘.</p>
<p>Now it’s possible to generate a database table and its schema from this by using the Migrations tool, which is run in the Package Manager Console – find this in ‘<em>Tools</em>‘ – ‘<em>NuGet Package Manager</em>‘ – ‘<em>Package Manager Console</em>‘. Basically this is a PowerShell command line interface, and we can do more than simply fetch and remove packages.</p>
<p><code>PM&gt; enable-migrations  
PM&gt; add-migration InitialMigration</code></p>
<p>The console should contain:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a>PM&gt; enable-migrations  
<a id="__codelineno-2-2" name="__codelineno-2-2"></a>Checking if the context targets an existing database...  
<a id="__codelineno-2-3" name="__codelineno-2-3"></a>Code First Migrations enabled for project CodeFirstExample.  
<a id="__codelineno-2-4" name="__codelineno-2-4"></a>PM&gt; add-migration InitialMigration  
<a id="__codelineno-2-5" name="__codelineno-2-5"></a>Scaffolding migration &#39;InitialMigration&#39;.  
<a id="__codelineno-2-6" name="__codelineno-2-6"></a>The Designer Code for this migration file includes a snapshot of your current Code First model. This snapshot is used to calculate the changes to your model when you scaffold the next migration. If you make additional changes to your model that you want to include in this migration, then you can re-scaffold it by running &#39;Add-Migration InitialMigration&#39; again.  
<a id="__codelineno-2-7" name="__codelineno-2-7"></a>PM&gt;  
</code></pre></div>
<p>We should also see a Migrations folder appear in Solution Explorer, containing a <em>[migration name].cs</em> file. This will have C# methods containing code that looks very much like SQL – these should be easily translatable to actual SQL scripts.</p>
<p>To execute the migrations script, run the following command:<br />
<code>PM&gt; update-database</code></p>
<p>Now refresh the SQL Server Object Explorer window. If there is no configuration string included in <em>Web.config</em> or the connection string name isn’t specified in the DbContext, Entity Framework will create a database locally. Since I’ve already got SQL Server Express installed, the new schema appears under that connection name.<br />
The new database will be called something like ‘<em>aspnet-[project name]-timestamp</em>’, and it’ll have tables for the <em>ApplicationUser</em> identity. The table it uses for local accounts is <em>dbo.AspNetUsers</em>.</p>
<p>If the application was run, the login and register features should be functioning, and the <em>[Authorize]</em> attribute can be set on any controller action. A user could register and modify an account, and the login details will appear in the database table.</p>
<h2 id="creating-our-own-model">Creating Our Own Model</h2>
<p>Next I’ve defined my own model for a calendar application, by adding two classes: <em>MyCalendar</em> and <em>EventType</em>. In the <em>Models</em> folder, I’ve created another class file called ‘<em>MyCalendarModel.cs</em>‘, and added the following code into it:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1"></a>namespace CodeFirstExample.Models
<a id="__codelineno-3-2" name="__codelineno-3-2"></a>{
<a id="__codelineno-3-3" name="__codelineno-3-3"></a>    public class MyCalendar
<a id="__codelineno-3-4" name="__codelineno-3-4"></a>    {
<a id="__codelineno-3-5" name="__codelineno-3-5"></a>        public int Id { get; set; }
<a id="__codelineno-3-6" name="__codelineno-3-6"></a>
<a id="__codelineno-3-7" name="__codelineno-3-7"></a>        [Required]
<a id="__codelineno-3-8" name="__codelineno-3-8"></a>        public ApplicationUser CalendarUser { get; set; }
<a id="__codelineno-3-9" name="__codelineno-3-9"></a>        public DateTime DateTime { get; set; }
<a id="__codelineno-3-10" name="__codelineno-3-10"></a>        public string Location { get; set; }
<a id="__codelineno-3-11" name="__codelineno-3-11"></a>        public EventType EventType { get; set; }
<a id="__codelineno-3-12" name="__codelineno-3-12"></a>    }
<a id="__codelineno-3-13" name="__codelineno-3-13"></a>
<a id="__codelineno-3-14" name="__codelineno-3-14"></a>    public class EventType
<a id="__codelineno-3-15" name="__codelineno-3-15"></a>    {
<a id="__codelineno-3-16" name="__codelineno-3-16"></a>        public byte Id { get; set; }
<a id="__codelineno-3-17" name="__codelineno-3-17"></a>
<a id="__codelineno-3-18" name="__codelineno-3-18"></a>        [Required]
<a id="__codelineno-3-19" name="__codelineno-3-19"></a>        [StringLength(160)]
<a id="__codelineno-3-20" name="__codelineno-3-20"></a>        public string Name { get; set; }
<a id="__codelineno-3-21" name="__codelineno-3-21"></a>    }
<a id="__codelineno-3-22" name="__codelineno-3-22"></a>}
</code></pre></div>
<p>I want to also add the following import statements, in addition to the defaults:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1"></a>using System.Data.Entity;  
<a id="__codelineno-4-2" name="__codelineno-4-2"></a>using System.ComponentModel.DataAnnotations;  
</code></pre></div>
<p>Also, what I typically do with the model is add validation attributes. I think it’s safer and better to sort out the validation here rather than implement it solely in the view layer. I did also assume that these attributes would also give us more precise control of the data types in the database tables, but that doesn’t seem the case.</p>
<h2 id="adding-the-model-to-dbcontext">Adding the Model to DbContext</h2>
<p>Now we have two extra models that wouldn’t do anything unless they’re added to the <em>DbContext</em> class, so I’ve added them here.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1"></a>public class ApplicationDbContext : IdentityDbContext&lt;ApplicationUser&gt;
<a id="__codelineno-5-2" name="__codelineno-5-2"></a>{
<a id="__codelineno-5-3" name="__codelineno-5-3"></a>    public DbSet&lt;MyCalendar&gt; MyCalendars { get; set; }
<a id="__codelineno-5-4" name="__codelineno-5-4"></a>    public DbSet&lt;EventType&gt; EventTypes { get; set; }
<a id="__codelineno-5-5" name="__codelineno-5-5"></a>
<a id="__codelineno-5-6" name="__codelineno-5-6"></a>    public ApplicationDbContext()
<a id="__codelineno-5-7" name="__codelineno-5-7"></a>    :base(&quot;DefaultConnection&quot;, throwIfV1Schema: false)
<a id="__codelineno-5-8" name="__codelineno-5-8"></a>    {}
<a id="__codelineno-5-9" name="__codelineno-5-9"></a>
<a id="__codelineno-5-10" name="__codelineno-5-10"></a>    public static ApplicationDbContext Create()
<a id="__codelineno-5-11" name="__codelineno-5-11"></a>    {
<a id="__codelineno-5-12" name="__codelineno-5-12"></a>        return new ApplicationDbContext();
<a id="__codelineno-5-13" name="__codelineno-5-13"></a>    }
<a id="__codelineno-5-14" name="__codelineno-5-14"></a>}
</code></pre></div>
<p>I then cleaned and rebuilt the project, just to make sure there were no obvious errors before executing another migration.</p>
<h2 id="generating-the-migration-script-and-applying-the-changes">Generating the Migration Script and Applying the Changes</h2>
<p>Similar to what I did previously, but the migration is given a different name so I’d know later which script does what, and I’ll need to force the update-database command to overwrite the existing schema:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1"></a>PM&gt; add-migration AppendMyModels  
<a id="__codelineno-6-2" name="__codelineno-6-2"></a>PM&gt; update-database -Force  
</code></pre></div>
<p>In <em>Server Explorer</em> there’ll be two additional tables, <em>EventTypes</em> and <em>MyCalendars</em>, that were created by running the above on the migration script. The only thing I needed to do after that is populate the <em>EventTypes</em> table, as it’s there for populating a drop-down list.</p>
<p>Also, if we look in the table definition, we can see the data types have been loosely applied from the attributes in the model class, and primary and foreign keys were set.</p>
<h2 id="final-thing-populating-a-database-table-for-an-mvc-drop-down-menu">Final Thing: Populating a Database Table for an MVC Drop-Down Menu</h2>
<p>We could populate the <em>EventTypes</em> table by entering the values into it using <em>Server Explorer</em>, but doing it from a migration script enables us to replicate the changes with other databases much faster. For this, I’d need a black migration script template, which can be generated by running  <code>add migration PopulateEventTypes</code>.</p>
<p>I’ve populated the <em>Up()</em> method with a series of SQL INSERT statements. I’m assuming the other method, <em>Down()</em>, fetches or pulls things from the database.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1"></a>namespace CodeFirstExample.Migrations
<a id="__codelineno-7-2" name="__codelineno-7-2"></a>{
<a id="__codelineno-7-3" name="__codelineno-7-3"></a>    using System;
<a id="__codelineno-7-4" name="__codelineno-7-4"></a>    using System.Data.Entity.Migrations;
<a id="__codelineno-7-5" name="__codelineno-7-5"></a>
<a id="__codelineno-7-6" name="__codelineno-7-6"></a>    public partial class PopulateEventTypesTable : DbMigration
<a id="__codelineno-7-7" name="__codelineno-7-7"></a>    {
<a id="__codelineno-7-8" name="__codelineno-7-8"></a>        public override void Up()
<a id="__codelineno-7-9" name="__codelineno-7-9"></a>        {
<a id="__codelineno-7-10" name="__codelineno-7-10"></a>            Sql(&quot;INSERT INTO EventTypes(Id, Name) VALUES(1, &#39;Meeting&#39;)&quot;);
<a id="__codelineno-7-11" name="__codelineno-7-11"></a>            Sql(&quot;INSERT INTO EventTypes(Id, Name) VALUES(2, &#39;Travel&#39;)&quot;);
<a id="__codelineno-7-12" name="__codelineno-7-12"></a>            Sql(&quot;INSERT INTO EventTypes(Id, Name) VALUES(3, &#39;Family&#39;)&quot;);
<a id="__codelineno-7-13" name="__codelineno-7-13"></a>            Sql(&quot;INSERT INTO EventTypes(Id, Name) VALUES(4, &#39;Social&#39;)&quot;);
<a id="__codelineno-7-14" name="__codelineno-7-14"></a>            Sql(&quot;INSERT INTO EventTypes(Id, Name) VALUES(5, &#39;Holiday&#39;)&quot;);
<a id="__codelineno-7-15" name="__codelineno-7-15"></a>        }
<a id="__codelineno-7-16" name="__codelineno-7-16"></a>        public override void Down()
<a id="__codelineno-7-17" name="__codelineno-7-17"></a>        {
<a id="__codelineno-7-18" name="__codelineno-7-18"></a>        }
<a id="__codelineno-7-19" name="__codelineno-7-19"></a>    }
<a id="__codelineno-7-20" name="__codelineno-7-20"></a>}
</code></pre></div>
<p>Now run the migration script again, using ‘<em>update-database</em>‘ to populate the database table. Viewing the <em>EventTypes</em> table in the SQL Server Object Explorer, we should see it populated.</p>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="web-apis.html" class="md-footer__link md-footer__link--prev" aria-label="Previous: Web APIs" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Web APIs
            </div>
          </div>
        </a>
      
      
        
        <a href="identity-users-extension.html" class="md-footer__link md-footer__link--next" aria-label="Next: Extending ASP.NET IdentityUsers" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Extending ASP.NET IdentityUsers
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tabs", "navigation.sections", "navigation.indexes"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../assets/javascripts/workers/search.cefbb252.min.js"}</script>
    
    
      <script src="../assets/javascripts/bundle.a5f8ea78.min.js"></script>
      
    
  </body>
</html>