
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-8.0.5">
    
    
  <title>Michael's Site</title>

    
      <link rel="stylesheet" href="../assets/stylesheets/main.a617204b.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.9204c3b2.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#making-a-linux-kernel-module" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../index.html" title="Scarbrough@GitHub" class="md-header__button md-logo" aria-label="Scarbrough@GitHub" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Scarbrough@GitHub
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Linux Kernel Modules
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../index.html" class="md-tabs__link">
      Home
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../projects.html" class="md-tabs__link">
      Projects
    </a>
  </li>

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="index.html" class="md-tabs__link md-tabs__link--active">
        My Docs
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../index.html" title="Scarbrough@GitHub" class="md-nav__button md-logo" aria-label="Scarbrough@GitHub" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Scarbrough@GitHub
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../index.html" class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../projects.html" class="md-nav__link">
        Projects
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" checked>
      
      
      
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="index.html">My Docs</a>
          
            <label for="__nav_3">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="My Docs" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          My Docs
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="suggested-toolset.html" class="md-nav__link">
        Suggested Toolset
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="development-standards.html" class="md-nav__link">
        Development Standards
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="software-architecture-doc.html" class="md-nav__link">
        Software Architecture Document
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="github.html" class="md-nav__link">
        GitHub
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="docker.html" class="md-nav__link">
        Docker
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="solid.html" class="md-nav__link">
        SOLID Development
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="jso n-web-tokens.md" class="md-nav__link">
        JSON Web Tokens
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Linux Kernel Modules
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="linux-kernel-module.html" class="md-nav__link md-nav__link--active">
        Linux Kernel Modules
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#recap" class="md-nav__link">
    Recap
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#structure-of-a-kernel-module" class="md-nav__link">
    Structure of a Kernel Module
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#writing-the-module" class="md-nav__link">
    Writing the Module
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#practical-uses-and-security-implications" class="md-nav__link">
    Practical Uses and Security Implications
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="opencart.html" class="md-nav__link">
        OpenCart Development Notes
      </a>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_11" type="checkbox" id="__nav_3_11" >
      
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3_11">
          DotNet
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="DotNet" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_11">
          <span class="md-nav__icon md-icon"></span>
          DotNet
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="dotnet-core-6-ajax.html" class="md-nav__link">
        AJAX Requests in DotNET Core 6 MVC
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="ajax-view-injection.html" class="md-nav__link">
        AJAX View Injection
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="web-services.html" class="md-nav__link">
        Web Services
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="web-apis.html" class="md-nav__link">
        Web APIs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="code-first-setup.html" class="md-nav__link">
        Code First Entity Framework
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="identity-users-extension.html" class="md-nav__link">
        Extending ASP.NET IdentityUsers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="dotnet-core-6-mvc.html" class="md-nav__link">
        DotNET Core 6 MVC and Entity Framework
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_12" type="checkbox" id="__nav_3_12" >
      
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3_12">
          Database
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Database" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_12">
          <span class="md-nav__icon md-icon"></span>
          Database
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="basic-sql.html" class="md-nav__link">
        Basic SQL Scripts
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="sqlite.html" class="md-nav__link">
        SQLite3
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_13" type="checkbox" id="__nav_3_13" >
      
      
      
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3_13">
          Python
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Python" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_13">
          <span class="md-nav__icon md-icon"></span>
          Python
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="jupyter.html" class="md-nav__link">
        Jupyter Notebooks
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="pycrypto-aes.html" class="md-nav__link">
        PyCrypto AES
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="python-authentication.html" class="md-nav__link">
        Authentication with Python
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="smartcards.html" class="md-nav__link">
        Smart Card Programming
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#recap" class="md-nav__link">
    Recap
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#structure-of-a-kernel-module" class="md-nav__link">
    Structure of a Kernel Module
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#writing-the-module" class="md-nav__link">
    Writing the Module
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#practical-uses-and-security-implications" class="md-nav__link">
    Practical Uses and Security Implications
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                

<h1 id="making-a-linux-kernel-module">Making a Linux Kernel Module</h1>
<p>I set myself the task of adding code to the Linux Kernel by writing a <a href="http://www.ibm.com/developerworks/library/l-lkm/">loadable kernel module</a>, since I’m trying to get back into C programming.</p>
<h2 id="recap">Recap</h2>
<p>There are two main types of kernel module: <em>static</em> and <em>loadable</em>. The static modules are added into the kernel as its compiled. Loadable modules, on the other hand, are dynamic, and they’re loaded/unloaded during runtime. When loaded, they pretty much become part of the kernel.</p>
<p>There are two locations in the file system to note:</p>
<ul>
<li>/lib/modules is where the kernel modules are stored. There are subdirectories for the different types.</li>
<li>/etc/modules lists the modules to load during system boot.</li>
</ul>
<p>A standard Linux installation also ships with something called <em>modutils</em>, that is a group of programs for manipulating loadable kernel modules (LKMs):
-   insmod: Load module
-   rmmod: Unload module
-   depmod: Find dependencies
-   kerneld: Kernel daemon
-   ksyms: Show exported symbols
-   lsmod: List loaded modules
-   modinfo: Show module information
-   modprobe: Load module and resolve dependencies</p>
<p>But these can only be used with whatever’s already in the file system.</p>
<h2 id="structure-of-a-kernel-module">Structure of a Kernel Module</h2>
<p>A module is created a little differently from the typical C program. Whereas the typical program has a <em>main()</em> function, these have entry and exit functions, <em>module_init()</em> and <em>module_exit()</em>, as they must receive and hand over kernel execution. These correspond to the loading and unloading from kernel’s memory space, and they probably invoke whatever system calls for sorting out memory allocation.</p>
<h2 id="writing-the-module">Writing the Module</h2>
<p>The concept is simple: we merely write a C program, compile it, then use the <em>insmod</em> command. A simple ‘Hello World’ program is all we need to get things going, as the learning curve here is in getting our own module successfully loaded.</p>
<p>First we might need to install kernel headers, or <em>kernel-dev</em>, from the distribution’s repository. <a href="http://freeworld.thc.org/root/docs/loadable_kernel_modules/linux-lkm-howto/index.html">Other tutorials</a> recommend compiling and running from the most recent kernel.</p>
<p>The following is an edited ‘Hello World’ example from <a href="http://www.tldp.org/LDP/lkmpg/2.6/html/lkmpg.html">The Linux Documentation Project</a>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a>#include &lt;linux/module.h&gt; /* Needed by all modules */
<a id="__codelineno-0-2" name="__codelineno-0-2"></a>#include &lt;linux/kernel.h&gt; /* Needed for KERN_INFO */
<a id="__codelineno-0-3" name="__codelineno-0-3"></a>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a>int init_module(void)
<a id="__codelineno-0-5" name="__codelineno-0-5"></a>{
<a id="__codelineno-0-6" name="__codelineno-0-6"></a>printk(KERN_INFO &quot;Hello world 1.\n&quot;);
<a id="__codelineno-0-7" name="__codelineno-0-7"></a>
<a id="__codelineno-0-8" name="__codelineno-0-8"></a>*/ Non-0 return if init_module failed;*/
<a id="__codelineno-0-9" name="__codelineno-0-9"></a>return 0;
<a id="__codelineno-0-10" name="__codelineno-0-10"></a>}
<a id="__codelineno-0-11" name="__codelineno-0-11"></a>
<a id="__codelineno-0-12" name="__codelineno-0-12"></a>void cleanup_module(void)
<a id="__codelineno-0-13" name="__codelineno-0-13"></a>{
<a id="__codelineno-0-14" name="__codelineno-0-14"></a>printk(KERN_INFO &quot;Goodbye world 1.\n&quot;);
<a id="__codelineno-0-15" name="__codelineno-0-15"></a>}
</code></pre></div>
<p>We might think the next step is a matter of putting the code in an IDE, clicking compile/build, then loading the resulting object file. Unfortunately it’s not that simple. If we try, the compiler will throw up an error because it can’t find the headers to include. Also, the compiler links code to whatever objects are available in the standard library, and the objects for this module aren’t available until it’s loaded into kernel space.</p>
<p>Instead, we use a ‘makefile’. Create a new directory (here I’ve called it ‘<em>MyModule</em>‘). This will contain <em>mymodule.c</em> and the makefile. Next, open a new file in the IDE or text editor, then add the following:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1"></a>obj-m += mymodule.o
<a id="__codelineno-1-2" name="__codelineno-1-2"></a>
<a id="__codelineno-1-3" name="__codelineno-1-3"></a>all:
<a id="__codelineno-1-4" name="__codelineno-1-4"></a>make -C /lib/modules/$(shell uname -r)/build M=$(PWD) modules
<a id="__codelineno-1-5" name="__codelineno-1-5"></a>
<a id="__codelineno-1-6" name="__codelineno-1-6"></a>clean:
<a id="__codelineno-1-7" name="__codelineno-1-7"></a>make -C /lib/modules/$(shell uname -r)/build M=$(PWD) clean
</code></pre></div>
<p>Save this as ‘<em>Makefile</em>‘, in the directory that was just created. Now that directory will contain <em>mymodule.c</em> and <em>Makefile</em>. The next step is to build this using ‘<em>make</em>‘. The output should be something along the lines of:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a>michae;@scarbrough ~/MyModule  $make
<a id="__codelineno-2-2" name="__codelineno-2-2"></a>make -C /lib/modules/3.2.0-generic/build M=/home/michael/MyModule modules
<a id="__codelineno-2-3" name="__codelineno-2-3"></a>make[1]: Entering directory &#39;/usr/src/linux-headers-3.2.0-generic
<a id="__codelineno-2-4" name="__codelineno-2-4"></a>    CC [M] /home/michael/MyModule/mymodule.o
<a id="__codelineno-2-5" name="__codelineno-2-5"></a>    Building modules, stage 2.
<a id="__codelineno-2-6" name="__codelineno-2-6"></a>    MODPOST 1 modules
<a id="__codelineno-2-7" name="__codelineno-2-7"></a>    CC /home/michael/MyModule/mymodule.mod.o
<a id="__codelineno-2-8" name="__codelineno-2-8"></a>    LD [M]  
<a id="__codelineno-2-9" name="__codelineno-2-9"></a>make[1]: Leaving directory &#39;/usr/src/linux-headers-3.2.0-generic 
</code></pre></div>
<p>The directory should now be populated by the newly-created module and several other files. The module here is <em>mymodule.ko</em>.</p>
<p>The next step is to load <em>mymodule.ko</em> into the kernel’s memory space using <em>insmod()</em> as root.  </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1"></a>$su root  
<a id="__codelineno-3-2" name="__codelineno-3-2"></a>#insmod mymodule.ko  
</code></pre></div>
<p>Since I used ‘<em>printk</em>‘ and not ‘<em>printf</em>‘, nothing was printed to the screen. How can we determine whether it was successfully loaded? Use <em>lsmod</em>, of course:</p>
<p>And by checking <em>syslog</em>, we should find that the module has indeed printed a kernel message:  </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1"></a>#cd /var/log  
<a id="__codelineno-4-2" name="__codelineno-4-2"></a>#cat syslog  
</code></pre></div>
<p>The entry looking something like:</p>
<p><code>Sep 29 23:12:05 BEATRIX kernel: [19161.607371] Hello world 1.</code></p>
<p>The module doesn’t do much, but the important thing is we managed to create a module and load it.</p>
<h2 id="practical-uses-and-security-implications">Practical Uses and Security Implications</h2>
<p>By writing our own kernel modules, we can extend the functionality of the kernel, add our own drivers, interfaces and features, and as we’ve seen, a kernel module can be any C program created to perform any conceivable function.<br />
On a standard Linux installation there could be hundreds of them, even if only a fraction are ever used. A malicious program, for example a kernel-mode rootkit, could easily be hidden anywhere here. Next we could look in <em>/etc/modules</em> to see which of them load when the system boots. This seems the perfect way to hide a rootkit, short of compiling it into the kernel itself.</p>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="solid.html" class="md-footer__link md-footer__link--prev" aria-label="Previous: SOLID Development" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              SOLID Development
            </div>
          </div>
        </a>
      
      
        
        <a href="opencart.html" class="md-footer__link md-footer__link--next" aria-label="Next: OpenCart Development Notes" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              OpenCart Development Notes
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tabs", "navigation.sections", "navigation.indexes"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../assets/javascripts/workers/search.cefbb252.min.js"}</script>
    
    
      <script src="../assets/javascripts/bundle.a5f8ea78.min.js"></script>
      
    
  </body>
</html>