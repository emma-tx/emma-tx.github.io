
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.3.1, mkdocs-material-8.4.2">
    
    
      
        <title>Docker Basics - scarbrough-trx @ GitHub</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.69437709.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.cbb835fc.min.css">
        
      
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#docker-basics" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="scarbrough-trx @ GitHub" class="md-header__button md-logo" aria-label="scarbrough-trx @ GitHub" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            scarbrough-trx @ GitHub
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Docker Basics
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../.." class="md-tabs__link">
      Home
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../about/" class="md-tabs__link">
      About
    </a>
  </li>

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../dotnet-core-azure-ad-authentication/" class="md-tabs__link md-tabs__link--active">
        Articles
      </a>
    </li>
  

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../resources/" class="md-tabs__link">
      Resources
    </a>
  </li>

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="scarbrough-trx @ GitHub" class="md-nav__button md-logo" aria-label="scarbrough-trx @ GitHub" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    scarbrough-trx @ GitHub
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../about/" class="md-nav__link">
        About
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Articles
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Articles" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Articles
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../dotnet-core-azure-ad-authentication/" class="md-nav__link">
        .NET Core Azure AD Authentication
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../entity-framework-migrations/" class="md-nav__link">
        Entity Framework Migrations
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../dotnet-core-xunit/" class="md-nav__link">
        .NET Core and xUnit Tests
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../sql-server-database-vs-project/" class="md-nav__link">
        Visual Studio SQL Server Database Project
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Docker Basics
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Docker Basics
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#requirements" class="md-nav__link">
    Requirements
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#getting-started" class="md-nav__link">
    Getting Started
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-an-image-from-an-existing-project" class="md-nav__link">
    Creating an Image From an Existing Project
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pushing-image-to-azure-container-registry" class="md-nav__link">
    Pushing Image to Azure Container Registry
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#recommended-image-tags" class="md-nav__link">
    Recommended Image Tags
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#useful-commands" class="md-nav__link">
    Useful Commands
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#volumes" class="md-nav__link">
    Volumes
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sql-server-image" class="md-nav__link">
    SQL Server Image
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docker-and-visual-studio" class="md-nav__link">
    Docker and Visual Studio
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docker-compose-files" class="md-nav__link">
    Docker Compose Files
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#process-for-running-services-in-a-container" class="md-nav__link">
    Process for Running Services in a Container
  </a>
  
    <nav class="md-nav" aria-label="Process for Running Services in a Container">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-clone-the-github-repository-for-the-serviceapplication-being-tested-or-built" class="md-nav__link">
    1. Clone the GitHub repository for the service/application being tested or built.
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-autheticate-the-windows-terminal-or-powershell-session-with-azure" class="md-nav__link">
    2. Autheticate the Windows Terminal or PowerShell session with Azure.
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-get-the-image-names-from-the-azure-container-registry" class="md-nav__link">
    3. Get the image name(s) from the Azure Container Registry
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-pull-the-required-images-from-the-azure-container-registry" class="md-nav__link">
    4. Pull the required images from the Azure Container Registry
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-run-the-docker-compose-script" class="md-nav__link">
    5. Run the docker-compose script
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-run-the-docker-compose-script_1" class="md-nav__link">
    5. Run the docker-compose script
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#troubleshooting-getting-started" class="md-nav__link">
    Troubleshooting (Getting Started)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#troubleshooting-building-docker-image-from-source" class="md-nav__link">
    Troubleshooting (Building Docker Image from Source)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#other-information" class="md-nav__link">
    Other Information
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../dotnet-core-6-ef-mvc/" class="md-nav__link">
        .NET Core, Entity Framework and MVC
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../dotnet-core-ajax/" class="md-nav__link">
        Implementing AJAX in .NET Core MVC
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ef-core-cli-reference/" class="md-nav__link">
        Entity Framework Core CLI Reference
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kestrel-errors/" class="md-nav__link">
        Kestrel HTTPS Error
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../docker-missing-dotnet-sdk/" class="md-nav__link">
        Missing .NET SDK Error (Docker)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../repository-pattern-and-uow/" class="md-nav__link">
        Repository Pattern and UoW
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../resources/" class="md-nav__link">
        Resources
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#requirements" class="md-nav__link">
    Requirements
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#getting-started" class="md-nav__link">
    Getting Started
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-an-image-from-an-existing-project" class="md-nav__link">
    Creating an Image From an Existing Project
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pushing-image-to-azure-container-registry" class="md-nav__link">
    Pushing Image to Azure Container Registry
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#recommended-image-tags" class="md-nav__link">
    Recommended Image Tags
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#useful-commands" class="md-nav__link">
    Useful Commands
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#volumes" class="md-nav__link">
    Volumes
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sql-server-image" class="md-nav__link">
    SQL Server Image
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docker-and-visual-studio" class="md-nav__link">
    Docker and Visual Studio
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docker-compose-files" class="md-nav__link">
    Docker Compose Files
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#process-for-running-services-in-a-container" class="md-nav__link">
    Process for Running Services in a Container
  </a>
  
    <nav class="md-nav" aria-label="Process for Running Services in a Container">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-clone-the-github-repository-for-the-serviceapplication-being-tested-or-built" class="md-nav__link">
    1. Clone the GitHub repository for the service/application being tested or built.
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-autheticate-the-windows-terminal-or-powershell-session-with-azure" class="md-nav__link">
    2. Autheticate the Windows Terminal or PowerShell session with Azure.
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-get-the-image-names-from-the-azure-container-registry" class="md-nav__link">
    3. Get the image name(s) from the Azure Container Registry
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-pull-the-required-images-from-the-azure-container-registry" class="md-nav__link">
    4. Pull the required images from the Azure Container Registry
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-run-the-docker-compose-script" class="md-nav__link">
    5. Run the docker-compose script
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-run-the-docker-compose-script_1" class="md-nav__link">
    5. Run the docker-compose script
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#troubleshooting-getting-started" class="md-nav__link">
    Troubleshooting (Getting Started)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#troubleshooting-building-docker-image-from-source" class="md-nav__link">
    Troubleshooting (Building Docker Image from Source)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#other-information" class="md-nav__link">
    Other Information
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                


<h1 id="docker-basics">Docker Basics</h1>
<p>A Docker container runs as a sandboxed process on a local system or a server, and consists of at least one image. An image is built from the source code of an application or service, and can be distributed, through a repository, to provide others the means of testing an existing software product with minimal setup.</p>
<p>Containers and images can be managed through the Docker Dashboard application. As such, a Docker container will require its own configurations and script that enable it to run as intended.</p>
<p>Though we are currently using the Docker Desktop application and Docker CLI, the repository of images is hosted by an Azure Container Registry.</p>
<h2 id="requirements">Requirements</h2>
<ul>
<li>Docker Hub account</li>
<li>Docker Desktop application</li>
<li>Docker CLI</li>
<li>Windows Terminal or PowerShell</li>
<li>Azure CLI</li>
<li>Access to the repositories</li>
<li>Access to the Azure Container Registry</li>
</ul>
<h2 id="getting-started">Getting Started</h2>
<p>First, register an account with Docker Hub, at https://hub.docker.com/. After registering the account and doing whatever configuration is necessary, install the Docker Desktop client. The Docker CLI will also be required.</p>
<p><strong>Note:</strong> When registering a Docker Hub account, make a note of the username/ID, as the portal logins sometimes don't work with the registered email address.</p>
<p>There is a 'Getting Started' container, which has an nginx server and a few Web pages, that can be fetched and run, to check everything is working. To see this demo in action, run the following command in PowerShell or Windows Terminal:</p>
<pre><code>docker run -d -p 80:80 docker/getting-started
</code></pre>
<p>Navigate the browser to http://localhost to view the site.</p>
<h2 id="creating-an-image-from-an-existing-project">Creating an Image From an Existing Project</h2>
<p>To build an image from a software project this into a Docker image, a 'Dockerfile' is added to the project directory. It might look something like:</p>
<pre><code># syntax=docker/dockerfile:1
FROM node:12-alpine
RUN apk add --no-cache python2 g++ make
WORKDIR /app
COPY . .
RUN yarn install --production
CMD [&quot;node&quot;, &quot;src/index.js&quot;]
EXPOSE 3000
</code></pre>
<p>Then build the above project as a Docker container with the following command in the containing directory:</p>
<pre><code>$docker build -t my-project .
</code></pre>
<p>The container should be ready to run with the following command:</p>
<pre><code>$docker run -dp 3000:3000 my-project
</code></pre>
<p>The container should appear in the Docker Dashboard, where it could be managed.</p>
<hr />
<h2 id="pushing-image-to-azure-container-registry">Pushing Image to Azure Container Registry</h2>
<pre><code>docker tag local-image:tagname new-repo:tagname
docker push new-repo:tagname
</code></pre>
<p>The following is an example of the commands I used to push an image to the Docker Hub:</p>
<pre><code>PS C:\Users\emma&gt; docker login
Authenticating with existing credentials...
Login Succeeded
PS C:\Users\emma&gt; docker tag test-application:dev test-repository/test-application:dev
PS C:\Users\emma&gt; docker push test-repository/test-application:dev
The push refers to repository [docker.io/test-repository/test-application]
e7a596a1b658: Pushed
d89241eb9d34: Pushed
bb19eedc1dad: Pushed
d1597429d57f: Pushed
c891b6c5469a: Pushed
ad6562704f37: Pushed
dev: digest: [digest] size: 1578
</code></pre>
<hr />
<h2 id="recommended-image-tags">Recommended Image Tags</h2>
<ul>
<li>latest</li>
<li>stage</li>
<li>production</li>
</ul>
<hr />
<h2 id="useful-commands">Useful Commands</h2>
<pre><code>$docker image ls | grep [application-name]
$docker build -t [application-name]:latest
$docker build -t [application-name]:test
docker run -dp 3000:3000 [my-project]
</code></pre>
<hr />
<h2 id="volumes">Volumes</h2>
<p>In Docker, volumes should be created if application data needs to be made persistent. A Docker volume is very much like a partition, with its own Linux file system. If a service or database image is to use a volume, it must be declared in the service section of docker-compose.yml and at the end of the file, e.g.</p>
<pre><code>test.db:
    image: mcr.microsoft.com/mssql/server
    environment:
        - SA_PASSWORD=TestDB123
        - ACCEPT_EULA=Y
     ports:
        - &quot;1433:1433&quot;
     volumes:
        - test-datastore:/var/opt/mssql
...
volumes:
    - test-datastore:/var/opt/mssql
</code></pre>
<hr />
<h2 id="sql-server-image">SQL Server Image</h2>
<p>In order to set up a database for the Docker application, it's necessary to have a base Microsoft SQL Server image. We can pull this from an external repository:</p>
<pre><code>docker pull mcr.microsoft.com/mssql/server:2019-latest
</code></pre>
<p>The following command will initialise the database, configuring it to have the name 'testdb', run on port 1433, and with the default login password of 'TestDB123'. The database will use the test-datastore volume to make its data persistent:</p>
<pre><code>docker run -e &quot;ACCEPT_EULA=Y&quot; -e &quot;SA_PASSWORD=TestDB123&quot; -p 1433:1433 --name testdb -v test-datastore:/var/opt/mssql -d mcr.microsoft.com/mssql/server:2019-latest
</code></pre>
<p>In order to get a .NET application working with a SQL Server running as a Docker image, it might be necessary to use 'host.docker.internal' in the connection string as the host name, e.g.</p>
<pre><code>&quot;ConnectionStrings&quot;: {
  &quot;DefaultConnection&quot;: &quot;Server=host.docker.internal;Initial Catalog=dockertest;Integrated Security=false;User ID=SA;Password=StandardPass56&quot;
}
</code></pre>
<p>If, for some reason, the project references an older database connection in <em>Connected Services</em> and <em>Secrets.json</em>, these must be removed, as the application will otherwise revert to that.</p>
<p>As for the <em>docker-compose.yml</em> configuration, this seems to work:</p>
<pre><code>version: '3.4'

services:
  dotnet-core-6-mvc:
    image: ${DOCKER_REGISTRY-}dotnetcore6mvc
    build:
      context: .
      dockerfile: Test-MVC/Dockerfile

  DockerSqlServerNew:
    image: mcr.microsoft.com/mssql/server
    environment:
    - SA_PASSWORD=StandardPass56
    - ACCEPT_EULA=Y
    ports:
    - &quot;1443:1433&quot;
</code></pre>
<p>After running '<em>docker-compose build</em>' and '<em>docker-compose up</em>', the Docker registry should list a container that includes the DB service with the application.</p>
<hr />
<h2 id="docker-and-visual-studio">Docker and Visual Studio</h2>
<p>The first step is to set up Docker support in the Visual Studio project:
- Right-click on the project root, and select '<em>Add</em>' -&gt; '<em>Docker Support...</em>'.
- Right-click on the project root again, and select '<em>Add</em>' -&gt; '<em>Container Orchestrator Support...</em>'.</p>
<p>At this point, there should be a docker-compose section in the Visual Studio solution, with <em>.dockerignore</em> and <em>docker-compose.yml</em> files in the solution directory. There will also be a hidden override file there, plus a Dockerfile within the project. Combined, these should enable other developers to replicate the process of creating the images.</p>
<p>The <em>docker-compose.yml</em> file should initially contain the following:</p>
<pre><code>version: '3.4'

services:
  dotnet-core-6-mvc:
    image: ${DOCKER_REGISTRY-}dotnetcore6mvc
    build:
      context: .
      dockerfile: Test-MVC/Dockerfile
</code></pre>
<p>Also, the Visual Studio debug options will be replaced with the configuration for <em>Docker Compose</em>. To run the project using IIS Express again, just click the drop-down with '<em>docker-compose</em>' and select the original project name.</p>
<p>The .NET Core application will run as a Docker container, referenced in the Docker registry. Aside from not being able to connect to a local database server, it runs well enough.</p>
<hr />
<h2 id="docker-compose-files">Docker Compose Files</h2>
<p>Each repository should include the following docker-compose files:
- <strong>docker-compose.yml:</strong> This file is used for pulling all images from the Azure Container Registry and composing a Docker container with them. To be run within Windows Terminal or PowerShell. The image(s) for this project do not exist in the Azure Container Registry at the time of writing.
- <strong>docker-compose-dependencies.yml:</strong> # This file is used for pulling images for any additional services required for debugging this project in the developer environment (e.g. Visual Studio or Visual Studio Code)
- <strong>docker-compose-build.yml:</strong> This file is to be used when building a new Docker image from the source, with images for associated services being pulled from Azure Container Registry to ensure there are no breaking changes. Building this image and running it, alongside the others in a container, could be considered an integration test.</p>
<hr />
<h2 id="process-for-running-services-in-a-container">Process for Running Services in a Container</h2>
<h3 id="1-clone-the-github-repository-for-the-serviceapplication-being-tested-or-built">1. Clone the GitHub repository for the service/application being tested or built.</h3>
<p>This repository should include all the required Docker configurations.</p>
<h3 id="2-autheticate-the-windows-terminal-or-powershell-session-with-azure">2. Autheticate the Windows Terminal or PowerShell session with Azure.</h3>
<p>Use the <code>az acr login</code> command.</p>
<h3 id="3-get-the-image-names-from-the-azure-container-registry">3. Get the image name(s) from the Azure Container Registry</h3>
<pre><code>az acr repository list --name [registry name]
</code></pre>
<h3 id="4-pull-the-required-images-from-the-azure-container-registry">4. Pull the required images from the Azure Container Registry</h3>
<pre><code>docker pull [registry].azurecr.io/[image name]
</code></pre>
<p>By default, the Azure client will pull the image tagged 'latest'.</p>
<h3 id="5-run-the-docker-compose-script">5. Run the docker-compose script</h3>
<p>How docker-compose should be used will depend on the context in which the container is to be run. To simply compose the container from a number of images, without making changes, navigate to the project's directory and run the following command: </p>
<pre><code>$ docker-compose -f docker-compose.yml up
</code></pre>
<p>To build a new image for the selected project, and run it in a container with other images:</p>
<pre><code>$ docker-compose -f docker-compose-build.yml
</code></pre>
<p>And to build a container that enables debugging in an Integrated Developer Environment, with other images providing the dependencies:</p>
<pre><code>$ docker-compose -f docker-compose-dependencies.yml
</code></pre>
<h3 id="5-run-the-docker-compose-script_1">5. Run the docker-compose script</h3>
<p>How docker-compose should be used will depend on the context in which the container is to be run. To simply compose the container from a number of images, without making changes, navigate to the project's directory and run the following command: </p>
<pre><code>$ docker-compose -f docker-compose.yml
</code></pre>
<p>To build a new image for the selected project, and run it in a container with other images:</p>
<pre><code>$ docker-compose -f docker-compose-build.yml
</code></pre>
<p>And to build a container that enables debugging in an Integrated Developer Environment, with other images providing the dependencies:</p>
<pre><code>$ docker-compose -f docker-compose-dependencies.yml
</code></pre>
<hr />
<h2 id="troubleshooting-getting-started">Troubleshooting (Getting Started)</h2>
<ol>
<li>Open PowerShell as admin, and use the following:</li>
</ol>
<p><code>&amp; 'C:\Program Files\Docker\Docker\DockerCli.exe' -SwitchDaemon</code></p>
<ol>
<li>
<p>In many cases the problem is caused by the Docker Engine failing to start. The indicators for this are the coloured bar at the lower left of the desktop GUI, and the set of ions to the right of the Windows task bar.</p>
</li>
<li>
<p>Try enabling the Windows Subsystem for Linux (Turn Windows features on or off), and installing the latest WSL kernel update.</p>
</li>
</ol>
<hr />
<h2 id="troubleshooting-building-docker-image-from-source">Troubleshooting (Building Docker Image from Source)</h2>
<p>There were three problems encountered in getting one of the services to run as a Docker container.</p>
<ul>
<li><strong>Missing SDK Error:</strong> The two most likely causes are that a) The SDK base image doesn't exist locally, and b) Docker is attempting to build the service without its dependencies, which are provided another project in the same solution directory. Check that <em>docker-compose.yml</em> is present in the solution's root directory, and the Dockerfile is copying the entire solution directory into <em>/app</em> and building the service and the referenced projects. See the wiki page for this error for further details.</li>
</ul>
<hr />
<h2 id="other-information">Other Information</h2>
<p><a href="https://docker-docs.netlify.app/compose/reference/overview/">Overview of docker-compose CLI</a></p>




              
            </article>
            
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../sql-server-database-vs-project/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Visual Studio SQL Server Database Project" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Visual Studio SQL Server Database Project
            </div>
          </div>
        </a>
      
      
        
        <a href="../dotnet-core-6-ef-mvc/" class="md-footer__link md-footer__link--next" aria-label="Next: .NET Core, Entity Framework and MVC" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              .NET Core, Entity Framework and MVC
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs"], "search": "../../assets/javascripts/workers/search.ecf98df9.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.9c69f0bc.min.js"></script>
      
    
  </body>
</html>